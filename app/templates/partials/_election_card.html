{# app/templates/partials/_election_card.html #}
{% macro election_card(e, is_admin=False, default_image=None, variant='list') -%}
  <article class="media-card {{ 'media-card--detail' if variant == 'detail' }}">
    <div class="media-card__media">
      <img src="{{ e.image_url or default_image }}" alt="" loading="lazy">
    </div>

    <div class="media-card__content">
      {# If the macro is used with {% call %}, render that custom content. #}
      {% if caller is defined %}
        {{ caller() }}
      {% else %}
        {# ---- Default LIST content (used on index) ---- #}
        <h3 class="media-card__title">{{ e.title }}</h3>
        {% if e.description %}
          <div class="muted md media-card__desc">{{ e.description|md }}</div>
        {% endif %}

        <div class="election-meta">
          <span class="tag">
            {{ utc_to_local_human(e.start_at) }} → {{ utc_to_local_human(e.end_at) }}
          </span>

          {% if e.is_open() %}
            <span class="form-inline">Kosningu lýkur: {{ utc_to_local_human(e.end_at) }}</span>
          {% elif e.is_upcoming() %}
            <span class="tag">Kosning hefst: {{ utc_to_local_human(e.start_at) }}</span>
          {% else %}
            <span class="form-inline">Kosningu lokið</span>
            <a class="btn secondary" href="{{ url_for('voting.export_votes', election_id=e.id) }}">Export CSV</a>
          {% endif %}
        </div>

        <div class="actions">
          <a class="btn" href="{{ url_for('voting.election_detail', election_id=e.id) }}">Skoða</a>

          {% if is_admin %}
            {% if e.is_open() %}
              <form class="form-inline" method="post" action="{{ url_for('admin.close_election', election_id=e.id) }}">
                <button class="btn danger" type="submit" aria-label="Close election now">Loka</button>
              </form>
            {% elif not e.is_upcoming() %}
              <form class="form-inline" method="post" action="{{ url_for('admin.reopen_election', election_id=e.id) }}">
                <button class="btn secondary" type="submit" aria-label="Reopen election">Opna</button>
              </form>
            {% endif %}

            <form class="form-inline" method="post" action="{{ url_for('admin.delete_election', election_id=e.id) }}"
                  onsubmit="return confirm('Delete this election and ALL its votes?')">
              <button class="btn danger" type="submit">Eyða</button>
            </form>
          {% endif %}
        </div>
      {% endif %}
    </div>
  </article>
{%- endmacro %}
